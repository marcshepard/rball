<!-- rball.html; the main web page for the site -->

<!-- Title and icon that appear in browser tab for this site -->
<head>
	<title>rball</title>
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" href="/favicon.ico">
</head>

<body>
</body>

<!-- Template layout for all virtual pages -->
<template name="ApplicationLayout">
    {{> yield "navbar"}}
    {{> yield "main"}}  
</template>

<!-- Navigation bar, collapses to "hamburger" on smaller screens -->
<template name="navbar">
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <img class="pull-left img_logo" src="/logo.jpg">
                <span class="navbar-brand">&nbsp;&nbsp;{{> loginButtons}}</span>
                <button type="button" class="navbar-toggle navbar-center" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>                        
                </button>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li id="nav_home"><a href="/">Home</a></li>
                    <li id="nav_about"><a href="/about">About</a></li>
                    <li id="nav_settings"><a href="/settings">Settings</a></li>
                </ul>
            </div>
        </div>
    </nav>
</template>

<!-- Home page, with context-specific text -->
<template name="home">
    <div class="container">
        <p>Welcome to the <a href="/about">MSFT racquetball ladder</a>! <b>The current round ends {{roundEnds}}.</b> {{roundMsg}}
        Please schedule your games now to avoid no-play penalties (or worse).</p>
{{#if currentUser}}
    {{#if activeUser}}
        {{> enterResults}}
    {{else}}
        <p>You are inactive this round. Go to <a href="/settings">settings</a> to change status for next round.</p>
    {{/if}}
        {{> activePlayers}}
{{else}}
        <p>Please sign in to use this site.</p>
{{/if}}
    </div>
</template>

<!-- enterResults form appears on home page for logged in active users -->
<template name="enterResults">
    <div>
        <p><b>Report results</b></p>
        <p>Once you have submitted results for both required matches, you will have the option to submit a bonus match against other active players who have finished their required matches.</p>    
        <table class="form_table">
{{#if above}}
            <tr>
                <td class="form_table_data" align="right">Above vs {{above}}: &nbsp;</td>
                <td class="form_table_data"><select id="above_result"><option value="N"></option><option value="W">W</option><option value="L">L</option><option value="WF">WF</option><option value="LF">LF</option><option value="T">T</option></select></td>
            </tr>

{{/if}}
{{#if below}}
            <tr>
                <td class="form_table_data" align="right" >Below vs {{below}}: &nbsp;</td>
                <td class="form_table_data"><select class="b" id="below_result"><option value="N"></option><option value="W">W</option><option value="L">L</option><option value="WF">WF</option><option value="LF">LF</option><option value="T">T</option></select></td>
            </tr>
            
{{/if}}
            <tr>
                <td class="form_table_data" align="right" >Bonus vs
                    <select id="bonus_user">
{{#each bonusUsers}}
                        <option>{{username}}</option>
{{/each}}
                    </select>: &nbsp;</td>
                <td class="form_table_data"><select id="bonus_result"><option value="N"></option><option value="W">W</option><option value="L">L</option><option value="WF">WF</option><option value="LF">LF</option><option value="T">T</option></select></td>
            </tr>
            <tr>
                <td class="form_table_data"><button type="submit" id="submit_results" onmouseout="clearResultsStatus()">Report</button></td>
                <td class="form_table_data"><span id="submit_results_status"></span></td>
            </tr>
        </table>
        <br/>
    </div>
    <script>
        document.getElementById("above_result").selectedIndex = {{aboveIx}};
        document.getElementById("below_result").selectedIndex = {{belowIx}};
        document.getElementById("bonus_result").selectedIndex = {{bonusIx}};
        document.getElementById("bonus_user").selectedIndex = {{bonusUserIx}};
        function clearResultsStatus() {document.getElementById("submit_results_status").innerHTML = ""};
    </script>
</template>

<!-- activePlayers list appears on home page for any logged in users. XXX - should we restrict to just "approved" users? -->
<template name="activePlayers">
    <p><b>Active players this round</b></p>
    <div class="table-responsive">
        <table class="table table-striped table-condensed">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Points</th>
                    <th>Player</th>
                    <th>Prev Rank</th>
                    <th>Prev Above Result</th>
                    <th>Prev Below Result</th>
                    <th>Prev Bonus Result</th>
                </tr>
            </thead>
            <tbody>
{{#each players}}
                <tr>
                    <td>{{rank}}</td>
                    <td>{{points}}</td>
                    <td><a href="mailto:{{email}}">{{username}}</a></td>
                    <td>{{prevRank}}</td>
                    <td>{{prevAboveResult}} {{prevAboveUserName}}</td>
                    <td>{{prevBelowResult}} {{prevBelowUserName}}</td>
                    <td>{{prevBonusResult}} {{prevBonusUserName}}</td>
                </tr>
{{/each}}
            </tbody>
        </table>
    </div>
</template>

<!-- About page - info about the ladder and rules -->
<template name="about">
    <div class="container">
        <h1>Ladder Overview</h1>
        <p>
            Welcome to the Microsoft Racquetball ladder! Ladder matches are played at the <a href="http://www.proclub.com">pro club</a> as
            an alternative to the pro club ladder (which doesn't require people to actually play their matches). Although started as a
            Microsoft ladder, it currently includes many non-Microsoft people. Every two weeks or so (a bit longer during holidays), a new
            "Round" is started, peoples ranks are adjusted, and active players schedule matches with the people immediately above and below
            them (and can optionally play a bonus match with anyone near them).
        </p>

        <h1>Ladder rules</h1>
        <p>Being on the ladder is a privilege, so as a courtesy to others please make an attempt to play your matches. If you consistently miss matches, you may be dropped from the ladder (by me). If you need to drop temporarily due to work schedule, vacation, etc, just update your status on the login page and update it again when you are reqady to rejoin. You will return you with the same number of points as you left with. It is an easy thing to do, and allows the others on the ladder to keep playing their matches.</p>
        <p>Matches are best of three, the first two games first to 15 (no need to win by two), with the tie breaker game first to 11 (no need to win by two). If both players agree, the tie breaker game can be played to 15. For the tie breaker, the general rule is that the person who had the most points in the game they lost gets to serve the tie breaker. If both players had the same points in their respective losses, you should lag for serve (as you do to start the first game).</p>
        <p>Schedule your matches early, and get them played. You are required to play the person immediately above you, and the person immediately below you. (Of course, number 1 only has one required match, as does the person at the bottom of the ladder.) You will gain 1.1 points for each match won, and you will lose 1.1 points for a match loss. Remember, there is a -1.2 point penalty for no plays. This is actually worse than a loss, so if you can play, but your partner can't, feel free to take a forfeit.</p>
        <p><b>Please do NOT report a W for a match that is not played.</b> Only report a W if you play and win the match. If the match is not played, it is either to be reported as a WF, or left as a no play. I want to know who is playing and who is not. I can’t do so if you report a W for a match not played. I’m asking for you all to be honest here and play by my rules.</p>
        <p>There also is the ability to have a bonus match. Each player is limited to one bonus match per round. That match can be against anyone on the ladder, provided both players have reported both their other match results. If anyone sends in a bonus match, and one of the two participants has not reported both required matches before I process the ladder, the bonus match will not count. Bonus matches are for those players who have scheduled both their required ladder matches. Before scheduling a bonus match with someone, you might want to check with them to make sure they'll get both their other matches in. We've had a number of cases where one person in the bonus round failed to get both matches in, causing the other player (usually the winner of the bonus match), to miss out on the points. Again, for the top and bottom players, this means after scheduling the one required match with your immediate partner. The winner of a bonus match will receive points (up to 1.1, depending upon how far apart in the ladder the two players are). The loser will not lose any points. This should allow lower level players to challenge those higher than themselves, without the higher player being concerned about losing points to a lower opponent.</p>
        <p>A clarification on the bonus point system. If a lower ranking player beats a higher ranking player, he or she will actually receive more than 1.1 points. You get 1.1 points for the win, plus 0.1 points for every spot higher on the ladder the opponent is than yourself. Also, you lose 0.1 points per ranking position if you are the higher ranked player who won. So, point wise, it doesn't really do you much good to beat up on players more than a few positions below you in the ladder. It may still be a fun match, just don't expect to get the same 1.1 points as a normal match.</p>
        <p>There have also been questions regarding the point system. Simply put, the points won/lost for each round do not directly carry over to the next round. They are simply used to calculate a position on the new ladder. The way the scoring works, is that everyone starts with a base number of points (99), and from there, you subtract your position for the current ladder. That gives you your base points. Then, you add or subtract your points for the current round. That gives you your points for this round. I then sort on those points, rank the players, and that's how it works. So, points do not carry over (nor are they cumulative between rounds).</p>
        <p>I also implemented a Tie match result. This is for matches that have been played, but no winner was declared due to lack of time to complete the match (not due to an injury - that is a forfeit). In this case, the match goes in as a 'T', with no points awarded or lost. This is only for matches that have been scheduled, but could not be completed, as you lost the court, and couldn't schedule the completion. A tie is not for matches where neither players schedules worked out to schedule the match. In those cases, you would need to take a no play.</p>
        <p>A WF or LF in the results indicate a win or loss by forfeit.</p>

        <h2>Eyewear</h2>
        <p>Each player is required to wear some sort of eye protection during match play. The member vote was to allow regular glasses, so that will stand. The main reason behind this is a few players stated their glasses were regulation, but you wouldn't necessarily be able to tell by looking. So, to not cause problems with that, standard glasses are permitted for play. If a player shows up for a match without any eye wear, the opponent has the OPTION of reporting that match as a forfeit, if he or she so chooses. That does not mean it is an automatic forfeit. The opponent can choose to play the match against the person without eyewear, but if so, no forfeit can be reported (due to lack of eye glasses).</p>

        <h2>Backwall</h2>
        <p>There no longer are any red lines on the back wall, so the only obstructions would be the vents, doors, and the seam where the glass and wall meet. If the ball hits any of them, simply call a court hinder and replay the point.</p>

        <h2>Additional info</h2>
        <p>If you have any questions or issues, please let send us an <a href="mailto:msladder@microsoft.com">email</a>.</p>
        <p>For scheduling matches, you can call the pro club or use their new <a href="http://proclub.com/Home/AthleticsFitness/Racquetball/tabid/305/Default.aspx">racquetball web site</a>.</p>
        <p>Also, for your reference, here is a link to the <a href="http://www.teamusa.org/~/media/USA_Racquetball/Documents/Rules/USARRulebookSeptember102013.pdf">US Racquetball Association</a>.</p>
    </div>
</template>

<!-- Settings page - with additional settings options for admins -->
<template name="settings">
    <div class="container">
{{#if currentUser}}
        <p><b>User settings</b></p> 
        <table class="form_table">
            <tr>
                <td class="form_table_data" align="right">Active Next Round: &nbsp;</td>
                <td class="form_table_data"><select id="new_active"><option>Yes</option><option>No</option></select></td>
            </tr>
            <tr>
                <td class="form_table_data" align="right">User Name: &nbsp;</td>
                <td class="form_table_data"><textarea id="new_username" maxlength="20" cols="20" rows="1">{{username}}</textarea></td>
            </tr>
            <tr>
                <td class="form_table_data" align="right">Email: &nbsp;</td>
                <td class="form_table_data"><textarea id="new_email" maxlength="30" cols="30" rows="1">{{email}}</textarea></td>
            </tr>
            <tr>
                <td class="form_table_data"><button type="submit" id="submit_settings" onmouseout="clearSettingsStatus()">Update</button></td>
                <td class="form_table_data"><span id="submit_settings_status"></span></td>
            </tr>
        </table>
        <br/>
{{#if admin}}
        <p><b>(Admin) Current round settings</b></p>
        <p>Change round message, extend end date</p>
        <br/>
        <p><b>(Admin) New Round</b></p>
        <p>Start new round, with specified end date and round message</p>
        <br/>
        <p><b>(Admin) User management</b></p>
        <p>TODO: Approve new users, unapprove users, delete users, change existing user attributes (rank/active/points)</p>
        <br />
{{/if}}
{{else}}
        <p>You must sign in to configure your settings</p>
{{/if}}
    </div>
    <script>
        //document.getElementById("new_active").selectedIndex = {{activeNextRoundIx}};
        function clearSettingsStatus() {document.getElementById("submit_settings_status").innerHTML = ""};
    </script>
</template>